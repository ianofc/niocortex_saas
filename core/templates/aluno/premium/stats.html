{% load static %}
<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Estatísticas Avançadas - NioCortex Premium">
    <title>Analytics Premium | NioCortex</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/perfis.css' %}" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: 'var(--color-primary)',
                        secondary: 'var(--color-secondary)',
                        accent: 'var(--color-accent)',
                        background: 'var(--bg-body)',
                        surface: 'var(--bg-card)',
                        text: 'var(--text-main)',
                        textMuted: 'var(--text-muted)',
                        premium: {
                            gold: '#F59E0B',
                            light: '#FEF3C7',
                            dark: '#92400E'
                        },
                        talkio: {
                            sidebar: 'var(--talkio-sidebar)',
                            chat: 'var(--talkio-chat)',
                            hover: 'var(--talkio-hover)',
                            bubbleOut: 'var(--talkio-bubble-out)',
                            bubbleIn: 'var(--talkio-bubble-in)',
                            meta: 'var(--talkio-meta)',
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                        'glow': '0 0 15px var(--color-primary)',
                        'gold': '0 4px 20px rgba(245, 158, 11, 0.25)',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'shimmer': 'shimmer 3s linear infinite',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        shimmer: { '0%': { backgroundPosition: '-1000px 0' }, '100%': { backgroundPosition: '1000px 0' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* Gráfico Circular CSS */
        .circular-chart {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            max-height: 250px;
        }
        .circle-bg {
            fill: none;
            stroke: #eee;
            stroke-width: 3.8;
        }
        .circle {
            fill: none;
            stroke-width: 2.8;
            stroke-linecap: round;
            animation: progress 1s ease-out forwards;
        }
        @keyframes progress {
            0% { stroke-dasharray: 0 100; }
        }
        .percentage {
            fill: var(--text-main);
            font-family: 'Outfit', sans-serif;
            font-weight: bold;
            font-size: 0.5em;
            text-anchor: middle;
        }

        /* Gradiente Premium */
        .text-gold-gradient {
            background: linear-gradient(135deg, #d97706 0%, #fbbf24 50%, #d97706 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Barras de Gráfico */
        .bar-container {
            height: 100%;
            display: flex;
            flex-prioris: column;
            justify-content: flex-end;
            align-items: center;
            gap: 0.5rem;
        }
        .bar {
            width: 100%;
            border-radius: 6px 6px 0 0;
            transition: height 1s ease-out;
            position: relative;
            overflow: hidden;
        }
        .bar::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, rgba(255,255,255,0.3), transparent);
        }
    </style>
</head>

<body x-data="appData({ gender: '{{ user.gender|default:'F' }}', is_premium: 'true' })" 
      x-init="init()"
      :class="theme === 'pink' ? 'theme-pink' : (theme === 'blue' ? 'theme-blue' : (theme === 'dark' ? 'theme-dark' : ''))"
      class="relative flex flex-col min-h-screen overflow-x-hidden font-sans antialiased selection:bg-amber-500 selection:text-white">

    <div class="fixed inset-0 z-0 transition-colors duration-700 pointer-events-none">
        <div class="absolute top-[-10%] left-[20%] w-[900px] h-[900px] rounded-full mix-blend-multiply filter blur-[120px] opacity-20 bg-amber-400 animate-float"></div>
        <div class="absolute bottom-[10%] right-[10%] w-[600px] h-[600px] rounded-full mix-blend-multiply filter blur-[120px] opacity-20 bg-purple-500 animate-float" style="animation-delay: 2s"></div>
        <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(var(--text-muted) 1px, transparent 1px); background-size: 30px 30px;"></div>
    </div>

    <nav class="sticky top-0 z-40 w-full px-4 py-2 transition-colors duration-300 shadow-sm glass-nav">
        <div class="flex items-center justify-between h-16 mx-auto max-w-7xl">
            <div class="flex items-center flex-1 gap-4">
                <a href="{% url 'core:aluno_dashboard' %}" class="flex items-center gap-3 group">
                    <div class="flex items-center justify-center w-10 h-10 text-lg font-bold text-white transition-transform shadow-lg rounded-xl group-hover:scale-110 bg-gradient-to-br from-amber-500 to-orange-600">N</div>
                    <div class="flex flex-col justify-center">
                        <span class="hidden text-xl font-bold leading-none tracking-tight font-display md:block" style="color: var(--text-main)">Nio<span class="text-amber-500">Premium</span></span>
                        <span class="text-[10px] uppercase font-bold tracking-widest opacity-60 hidden md:block" style="color: var(--text-muted)">Analytics Avançado</span>
                    </div>
                </a>
            </div>

            <div class="items-center justify-center flex-1 hidden gap-8 lg:flex">
                <a href="{% url 'core:aluno_dashboard' %}" class="relative flex flex-col items-center p-2 group" title="Início">
                    <i class="mb-1 text-2xl transition-colors duration-300 fas fa-home text-slate-400 group-hover:text-amber-500"></i>
                </a>
                <a href="#" class="relative flex flex-col items-center p-2 rounded-lg group" title="Estatísticas (Atual)">
                    <i class="mb-1 text-2xl transition-colors duration-300 fas fa-chart-line text-amber-500"></i>
                    <span class="absolute bottom-0 w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                </a>
                <a href="{% url 'core:student_grades' %}" class="relative flex flex-col items-center p-2 rounded-lg group hover:bg-black/5" title="Boletim">
                    <i class="mb-1 text-2xl transition-colors duration-300 fas fa-file-alt group-hover:text-amber-500 text-slate-400"></i>
                </a>
            </div>

            <div class="flex items-center justify-end flex-1 gap-4">
                <button @click="openTalkio()" class="relative flex items-center justify-center w-10 h-10 transition rounded-full hover:bg-black/5">
                    <img src="{% static 'imgs/talkio/Talkio_logo.png' %}" class="object-contain w-8 h-8 drop-shadow-sm">
                </button>
                <div class="relative ml-2 cursor-pointer group">
                    <div class="w-10 h-10 rounded-full p-[2px] bg-gradient-to-r from-amber-300 via-yellow-500 to-amber-600 animate-shimmer bg-[length:200%_100%]">
                        <img src="{% if user.avatar %}{{ user.avatar.url }}{% else %}https://i.pravatar.cc/150?img=32{% endif %}" class="object-cover w-full h-full border-2 border-white rounded-full">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="relative z-10 w-full p-6 pt-10 mx-auto max-w-7xl">
        
        <div class="flex flex-col items-end justify-between gap-4 mb-8 md:flex-row">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="px-2 py-0.5 rounded-md bg-amber-100 text-amber-700 text-[10px] font-bold uppercase tracking-wider border border-amber-200">Pro</span>
                    <span class="text-xs font-medium text-slate-500"><i class="mr-1 fas fa-sync-alt"></i> Atualizado agora</span>
                </div>
                <h1 class="text-3xl font-extrabold font-display text-slate-800">Desempenho Acadêmico</h1>
                <p class="text-sm text-slate-500">Visualize seu progresso e insights exclusivos da IA.</p>
            </div>
            
            <div class="flex gap-2">
                <button class="flex items-center gap-2 px-4 py-2 text-xs font-bold transition border border-white bg-white/60 backdrop-blur rounded-xl text-slate-600 hover:bg-white">
                    <i class="fas fa-calendar"></i> Últimos 30 dias
                </button>
                <button class="flex items-center gap-2 px-4 py-2 text-xs font-bold text-white transition shadow-lg bg-amber-500 rounded-xl shadow-amber-500/30 hover:bg-amber-600">
                    <i class="fas fa-download"></i> Exportar Relatório
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-6 mb-8 md:grid-cols-3">
            
            <div class="relative p-6 overflow-hidden transition duration-500 glass-panel rounded-3xl group hover:-translate-y-1">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <p class="text-xs font-bold tracking-wider uppercase text-slate-400">Média Global</p>
                        <h3 class="mt-1 text-3xl font-black font-display text-slate-800">9.2</h3>
                    </div>
                    <div class="flex items-center justify-center w-10 h-10 text-white shadow-lg rounded-xl bg-gradient-to-br from-green-400 to-emerald-600 shadow-green-400/30">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-sm">
                    <span class="text-green-600 font-bold bg-green-100 px-1.5 py-0.5 rounded text-xs">
                        <i class="fas fa-arrow-up"></i> 0.4
                    </span>
                    <span class="text-xs text-slate-400">vs. semestre anterior</span>
                </div>
                <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-green-400 to-emerald-600"></div>
            </div>

            <div class="relative p-6 overflow-hidden transition duration-500 glass-panel rounded-3xl group hover:-translate-y-1">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <p class="text-xs font-bold tracking-wider uppercase text-slate-400">Tempo de Foco</p>
                        <h3 class="mt-1 text-3xl font-black font-display text-slate-800">42h</h3>
                    </div>
                    <div class="flex items-center justify-center w-10 h-10 text-white shadow-lg rounded-xl bg-gradient-to-br from-blue-400 to-indigo-600 shadow-blue-400/30">
                        <i class="fas fa-stopwatch"></i>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-sm">
                    <span class="text-blue-600 font-bold bg-blue-100 px-1.5 py-0.5 rounded text-xs">
                        Top 5%
                    </span>
                    <span class="text-xs text-slate-400">dos alunos da turma</span>
                </div>
                <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 to-indigo-600"></div>
            </div>

            <div class="relative p-6 overflow-hidden transition duration-500 border glass-panel rounded-3xl group hover:-translate-y-1 border-amber-100">
                <div class="absolute top-0 right-0 p-3 opacity-10">
                    <i class="text-6xl fas fa-crown text-amber-500"></i>
                </div>
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <p class="text-xs font-bold tracking-wider uppercase text-slate-400">Ranking Geral</p>
                        <h3 class="mt-1 text-3xl font-black font-display text-amber-500">#3</h3>
                    </div>
                    <div class="flex items-center justify-center w-10 h-10 text-white shadow-lg rounded-xl bg-gradient-to-br from-amber-400 to-orange-600 shadow-amber-400/30">
                        <i class="fas fa-trophy"></i>
                    </div>
                </div>
                <div class="w-full h-2 mt-2 overflow-hidden rounded-full bg-slate-100">
                    <div class="bg-gradient-to-r from-amber-400 to-orange-600 h-full w-[95%] rounded-full relative">
                        <div class="absolute inset-0 bg-white/30 animate-pulse"></div>
                    </div>
                </div>
                <p class="mt-2 text-xs text-right text-slate-400">950 XP para o #2</p>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-6 mb-8 lg:grid-cols-3">
            
            <div class="p-6 lg:col-span-2 glass-panel rounded-3xl">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-bold text-slate-800"><i class="fas fa-chart-bar mr-2 text-[var(--color-primary)]"></i>Evolução das Notas</h3>
                    <select class="bg-slate-50 border-none text-xs rounded-lg px-3 py-1.5 text-slate-600 focus:ring-0 cursor-pointer">
                        <option>Todas as Disciplinas</option>
                        <option>Matemática</option>
                        <option>Português</option>
                    </select>
                </div>
                
                <div class="flex items-end justify-between h-64 gap-2 px-2 md:gap-4">
                    <div class="w-full cursor-pointer bar-container group">
                        <div class="mb-1 text-xs font-bold transition-opacity opacity-0 text-slate-500 group-hover:opacity-100">7.5</div>
                        <div class="bg-blue-300 bar group-hover:bg-blue-500" style="height: 75%;"></div>
                        <div class="text-[10px] font-bold text-slate-400 mt-2 uppercase">Fev</div>
                    </div>
                    <div class="w-full cursor-pointer bar-container group">
                        <div class="mb-1 text-xs font-bold transition-opacity opacity-0 text-slate-500 group-hover:opacity-100">8.0</div>
                        <div class="bg-blue-300 bar group-hover:bg-blue-500" style="height: 80%;"></div>
                        <div class="text-[10px] font-bold text-slate-400 mt-2 uppercase">Mar</div>
                    </div>
                    <div class="w-full cursor-pointer bar-container group">
                        <div class="mb-1 text-xs font-bold transition-opacity opacity-0 text-slate-500 group-hover:opacity-100">6.5</div>
                        <div class="bg-red-300 bar group-hover:bg-red-500" style="height: 65%;"></div>
                        <div class="text-[10px] font-bold text-slate-400 mt-2 uppercase">Abr</div>
                    </div>
                    <div class="w-full cursor-pointer bar-container group">
                        <div class="mb-1 text-xs font-bold transition-opacity opacity-0 text-slate-500 group-hover:opacity-100">8.5</div>
                        <div class="bg-blue-400 bar group-hover:bg-blue-600" style="height: 85%;"></div>
                        <div class="text-[10px] font-bold text-slate-400 mt-2 uppercase">Mai</div>
                    </div>
                    <div class="w-full cursor-pointer bar-container group">
                        <div class="mb-1 text-xs font-bold opacity-100 text-emerald-600">9.2</div>
                        <div class="shadow-lg bar bg-gradient-to-t from-emerald-400 to-teal-500 shadow-emerald-400/20" style="height: 92%;"></div>
                        <div class="text-[10px] font-bold text-emerald-600 mt-2 uppercase">Jun</div>
                    </div>
                </div>
            </div>

            <div class="relative p-6 overflow-hidden border border-purple-100 glass-panel rounded-3xl">
                <div class="absolute w-40 h-40 rounded-full -top-10 -right-10 bg-purple-500/10 blur-3xl"></div>
                
                <div class="relative z-10 flex items-center gap-2 mb-4">
                    <i class="text-xl text-purple-600 fas fa-brain"></i>
                    <h3 class="font-bold text-slate-800">Zios AI AI Insights</h3>
                </div>

                <div class="relative z-10 space-y-4">
                    <div class="p-4 border shadow-sm bg-white/60 backdrop-blur rounded-2xl border-white/60">
                        <div class="flex items-start gap-3">
                            <div class="flex items-center justify-center w-8 h-8 text-xs rounded-full bg-amber-100 text-amber-600 shrink-0">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div>
                                <p class="mb-1 text-xs font-bold text-slate-700">Padrão Identificado</p>
                                <p class="text-xs leading-relaxed text-slate-500">Você tende a ter notas 15% maiores quando estuda às terças-feiras de manhã.</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 border shadow-sm bg-white/60 backdrop-blur rounded-2xl border-white/60">
                        <div class="flex items-start gap-3">
                            <div class="flex items-center justify-center w-8 h-8 text-xs text-red-600 bg-red-100 rounded-full shrink-0">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div>
                                <p class="mb-1 text-xs font-bold text-slate-700">Atenção em Física</p>
                                <p class="text-xs leading-relaxed text-slate-500">Sua nota caiu na última prova. Recomendo revisar: <strong>Termodinâmica</strong>.</p>
                                <button class="mt-2 text-[10px] font-bold text-purple-600 hover:underline">Ver materiais sugeridos</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="w-full mt-4 py-2.5 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 text-white text-xs font-bold shadow-lg shadow-purple-500/20 hover:scale-[1.02] transition-transform">
                    Perguntar ao Zios AI
                </button>
            </div>
        </div>

        <div class="p-6 glass-panel rounded-3xl">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-slate-800">Consistência de Estudo</h3>
                <div class="flex items-center gap-2 text-xs text-slate-500">
                    <span>Menos</span>
                    <div class="flex gap-1">
                        <div class="w-3 h-3 rounded-sm bg-slate-200"></div>
                        <div class="w-3 h-3 rounded-sm bg-emerald-200"></div>
                        <div class="w-3 h-3 rounded-sm bg-emerald-400"></div>
                        <div class="w-3 h-3 rounded-sm bg-emerald-600"></div>
                    </div>
                    <span>Mais</span>
                </div>
            </div>
            
            <div class="flex gap-1 pb-2 overflow-x-auto scrollbar-hide">
                <script>
                    // Gerar grid via JS simples para não poluir o HTML
                    for(let i=0; i<30; i++) {
                        document.write('<div class="flex flex-col gap-1">');
                        for(let j=0; j<7; j++) {
                            const intensity = Math.random();
                            let color = 'bg-slate-200';
                            if(intensity > 0.85) color = 'bg-emerald-600';
                            else if(intensity > 0.6) color = 'bg-emerald-400';
                            else if(intensity > 0.3) color = 'bg-emerald-200';
                            
                            document.write(`<div class="w-3 h-3 rounded-sm ${color} hover:ring-1 ring-slate-400 transition" title="Estudou ${(intensity*4).toFixed(1)}h"></div>`);
                        }
                        document.write('</div>');
                    }
                </script>
            </div>
        </div>

    </main>

    <script src="{% static 'js/dashboard_aluno.js' %}"></script>
    
    <div x-cloak x-show="talkioOpen" class="fixed inset-0 z-[100] flex justify-center items-center">
        <div @click="talkioOpen = false" x-show="talkioOpen" x-transition.opacity class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="relative w-full max-w-6xl h-[90vh] bg-white rounded-xl shadow-2xl flex overflow-hidden">
             <div class="flex items-center justify-center w-full h-full text-gray-500">Talkio Drawer Carregado (Placeholder)</div>
        </div>
    </div>

</body>
</html>