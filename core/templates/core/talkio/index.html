{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talkio AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'core/css/themes.css' %}">
    <link rel="stylesheet" href="{% static 'core/css/talkio.css' %}">
    <script src="{% static 'core/js/theme_engine.js' %}"></script>
</head>
<body class="overflow-hidden bg-transparent">
    
    <div class="talkio-container">
        <div class="flex items-center gap-3 p-4 border-b border-[var(--border-color)]">
            <div class="relative">
                <img src="{% static 'imgs/talkio/Talkio_logo.png' %}" class="w-10 h-10">
                <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>
            </div>
            <div>
                <h3 class="font-bold text-[var(--text-main)]">Talkio Assistant</h3>
                <p class="text-xs text-[var(--text-muted)]">Online e pronto para ajudar</p>
            </div>
        </div>

        <div class="talkio-messages" id="messagesArea">
            <div class="msg-bubble msg-ai">
                Olá, {{ user.first_name }}! Sou o Talkio, sua IA educacional. 
                <br>Como posso ajudar nos seus estudos hoje?
            </div>
            
            </div>

        <div class="p-4 border-t border-[var(--border-color)] bg-[var(--bg-body)]">
            <form id="talkioForm" class="flex items-end gap-2">
                <div class="flex-1 relative">
                    <textarea id="promptInput" rows="1" placeholder="Digite sua dúvida..." 
                        class="w-full px-4 py-3 text-sm transition border rounded-2xl resize-none focus:ring-2 focus:ring-[var(--primary)] bg-[var(--bg-card)] text-[var(--text-main)] border-[var(--border-color)] outline-none scrollbar-hide"
                        style="min-height: 44px; max-height: 120px;"></textarea>
                    <button type="button" class="absolute right-3 top-3 text-[var(--text-muted)] hover:text-[var(--primary)]">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                <button type="submit" class="flex items-center justify-center w-11 h-11 rounded-full bg-[var(--primary)] text-white hover:opacity-90 transition shadow-lg">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </div>

    <script>
        const form = document.getElementById('talkioForm');
        const input = document.getElementById('promptInput');
        const area = document.getElementById('messagesArea');

        // Auto-resize textarea
        input.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const text = input.value.trim();
            if(!text) return;

            // Adiciona mensagem do usuário
            const userDiv = document.createElement('div');
            userDiv.className = 'msg-bubble msg-user';
            userDiv.innerText = text;
            area.appendChild(userDiv);
            
            input.value = '';
            input.style.height = '44px';
            area.scrollTop = area.scrollHeight;

            // Simula "Digitando..." e resposta da IA
            setTimeout(() => {
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'msg-bubble msg-ai';
                loadingDiv.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Pensando...';
                loadingDiv.id = 'loading';
                area.appendChild(loadingDiv);
                area.scrollTop = area.scrollHeight;

                setTimeout(() => {
                    document.getElementById('loading').remove();
                    const aiDiv = document.createElement('div');
                    aiDiv.className = 'msg-bubble msg-ai';
                    aiDiv.innerHTML = "Ainda estou aprendendo a me comunicar com o servidor backend, mas entendi sua solicitação: <b>" + text + "</b>.<br><br>Em breve estarei 100% operacional!";
                    area.appendChild(aiDiv);
                    area.scrollTop = area.scrollHeight;
                }, 1500);
            }, 500);
        });
    </script>
</body>
</html>