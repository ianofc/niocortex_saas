{% load static %}

{% if '/social/' in request.path %}
    {% with zios_greeting="E aÃ­! Eu sou o Zios AI. ðŸ˜Ž Pronto para ver o que tÃ¡ rolando na YourLife?" zios_role="social" %}
    <div id="zios-context" data-greeting="{{ zios_greeting }}" data-role="{{ zios_role }}" style="display:none;"></div>
    {% endwith %}
{% else %}
    {% with zios_greeting="Bem-vindo ao NioCortex." zios_role="admin" %}
    <div id="zios-context" data-greeting="{{ zios_greeting }}" data-role="{{ zios_role }}" style="display:none;"></div>
    {% endwith %}
{% endif %}

<div class="flex items-center justify-end flex-1 gap-3 md:gap-4" x-data="{ profileOpen: false }">

    <button @click="$dispatch('toggle-switcher')" 
            class="flex items-center justify-center w-10 h-10 transition-all border rounded-full group bg-white/5 hover:bg-white/10 border-white/10 text-slate-400 hover:text-white"
            title="NioCortex Apps">
        <i class="text-lg transition-transform fas fa-th group-hover:rotate-90"></i>
    </button>

    <button @click="$store.nav.toggle('zios')" 
            class="flex items-center justify-center w-10 h-10 transition-all border rounded-full bg-white/5 hover:bg-white/10 border-white/10 group"
            title="Assistente IA">
        <i class="text-xl text-purple-400 transition fas fa-brain group-hover:text-purple-500 animate-pulse"></i>
    </button>

    <a href="{% url 'yourlife_social:talkio_app' %}" 
            class="flex items-center justify-center w-10 h-10 transition-all border rounded-full bg-white/5 hover:bg-white/10 border-white/10"
            title="Talkio Messenger">
        <img src="{% static 'imgs/talkio/Talkio_logo.png' %}" class="w-6 h-6 opacity-90 hover:opacity-100">
    </a>
    
    <div class="relative">
        <button @click="profileOpen = !profileOpen" 
                class="flex items-center gap-2 py-1 pl-1 pr-3 transition-all border rounded-full bg-white/5 hover:bg-white/10 border-white/10">
            
            <img src="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}https://ui-avatars.com/api/?name={{ user.first_name }}&background=random&color=fff{% endif %}" 
                 class="object-cover w-8 h-8 border-2 rounded-full shadow-sm border-white/20">
            
            <i class="fas fa-chevron-down text-[10px] text-slate-400 transition-transform duration-300" 
               :class="profileOpen ? 'rotate-180' : ''"></i>
        </button>
        
        <div x-show="profileOpen" @click.away="profileOpen = false" x-cloak
             class="absolute top-14 right-0 w-72 bg-[#1A1F2C] rounded-2xl shadow-2xl z-[120] border border-white/10 overflow-hidden"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 translate-y-2"
             x-transition:enter-end="opacity-100 translate-y-0">
             
            <div class="p-4 border-b border-white/5 bg-white/5">
                <p class="font-bold leading-tight text-white">{{ user.get_full_name }}</p>
                <a href="{% url 'yourlife_social:meu_perfil' %}" class="text-xs font-bold text-purple-400 hover:text-purple-300">Ver Perfil Social</a>
            </div>
            
            <div class="p-2 space-y-1">
                <a href="{% url 'yourlife_social:settings_page' %}" class="block px-3 py-2 text-sm font-medium hover:bg-white/5 rounded-xl text-slate-300 hover:text-white">
                    <i class="w-5 fas fa-cog text-slate-500"></i> ConfiguraÃ§Ãµes
                </a>
                <a href="{% url 'yourlife_social:support_page' %}" class="block px-3 py-2 text-sm font-medium hover:bg-white/5 rounded-xl text-slate-300 hover:text-white">
                    <i class="w-5 fas fa-life-ring text-slate-500"></i> Suporte
                </a>
            </div>
            
            <div class="p-2 border-t border-white/5">
                <a href="{% url 'yourlife_social:logout' %}" class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-red-400 hover:bg-red-500/10 rounded-xl">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </a>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'core/js/navbar.js' %}"></script>
