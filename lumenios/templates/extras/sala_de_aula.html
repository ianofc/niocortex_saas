{% extends 'aluno/base_lumenios.html' %}

{% block content %}
<div class="flex flex-col lg:flex-row h-[calc(100vh-140px)] max-w-[1800px] mx-auto gap-6 px-6 pb-6" 
     x-data="{ sidebarTab: 'aulas' }">

    <div class="relative flex flex-col flex-1 min-w-0 overflow-hidden border shadow-2xl bg-white/80 backdrop-blur-xl border-white/60 rounded-[2.5rem] group transition-all duration-300">
        
        {% if conteudo_atual.tipo == 'VIDEO' %}
            <div class="relative w-full overflow-hidden aspect-video bg-slate-900 group-player">
                {% if conteudo_atual.embed_link %}
                    <iframe src="{{ conteudo_atual.embed_link }}" class="w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                {% else %}
                    <div class="absolute inset-0 flex flex-col items-center justify-center text-slate-500">
                        <i class="mb-4 text-6xl text-white/20 fas fa-play-circle"></i>
                        <p>Vídeo indisponível.</p>
                    </div>
                {% endif %}
            </div>

        {% elif conteudo_atual.tipo == 'EXERCICIO' %}
            <div class="flex flex-col w-full h-full p-10 overflow-y-auto bg-slate-50 custom-scrollbar">
                <div class="w-full max-w-3xl mx-auto">
                    <span class="px-3 py-1 mb-4 text-xs font-bold text-white bg-indigo-500 rounded-full w-fit">
                        <i class="mr-1 fas fa-pencil-alt"></i> Prática
                    </span>
                    <h2 class="mb-6 text-3xl font-bold text-slate-800 font-display">{{ conteudo_atual.titulo }}</h2>
                    
                    <div class="p-8 mb-6 bg-white border shadow-sm border-slate-200 rounded-3xl">
                        <p class="mb-6 text-lg leading-relaxed text-slate-700">
                            {{ conteudo_atual.texto_apoio|default:"Responda a questão abaixo:" }}
                        </p>
                        <div class="space-y-3">
                            <label class="flex items-center gap-4 p-4 transition border cursor-pointer rounded-2xl bg-slate-50 hover:bg-indigo-50 border-slate-200 hover:border-indigo-300 group">
                                <input type="radio" name="resp" class="w-5 h-5 text-indigo-600 border-slate-300 focus:ring-indigo-500">
                                <span class="font-medium text-slate-700 group-hover:text-indigo-900">Alternativa A</span>
                            </label>
                            <label class="flex items-center gap-4 p-4 transition border cursor-pointer rounded-2xl bg-slate-50 hover:bg-indigo-50 border-slate-200 hover:border-indigo-300 group">
                                <input type="radio" name="resp" class="w-5 h-5 text-indigo-600 border-slate-300 focus:ring-indigo-500">
                                <span class="font-medium text-slate-700 group-hover:text-indigo-900">Alternativa B</span>
                            </label>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button class="px-8 py-3 font-bold text-white transition transform bg-indigo-600 shadow-lg rounded-xl hover:bg-indigo-700 hover:-translate-y-1">
                            Enviar
                        </button>
                    </div>
                </div>
            </div>

        {% else %}
            <div class="flex items-center justify-center w-full h-64 bg-gradient-to-br from-indigo-50 to-purple-50">
                <div class="text-center">
                    <div class="flex items-center justify-center w-20 h-20 mx-auto mb-4 text-indigo-400 bg-white shadow-lg rounded-2xl">
                        <i class="text-4xl fas fa-file-alt"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-indigo-900">{{ conteudo_atual.titulo }}</h2>
                </div>
            </div>
        {% endif %}

        {% if conteudo_atual.tipo != 'EXERCICIO' %}
        <div class="flex-1 p-8 overflow-y-auto custom-scrollbar bg-gradient-to-b from-white to-slate-50/50">
            <div class="flex items-start justify-between mb-4">
                <div>
                    <h1 class="text-3xl font-bold leading-tight font-display text-slate-800">
                        {{ conteudo_atual.titulo|default:"Aula" }}
                    </h1>
                    <p class="flex items-center gap-2 mt-1 text-sm text-slate-500">
                        <i class="far fa-clock"></i> Módulo de Aprendizado
                    </p>
                </div>
                <div class="flex gap-2">
                    <button class="flex items-center justify-center w-10 h-10 transition rounded-xl bg-slate-100 hover:bg-indigo-50 hover:text-indigo-600"><i class="far fa-heart"></i></button>
                </div>
            </div>

            <div class="leading-relaxed prose prose-slate max-w-none text-slate-600">
                {{ conteudo_atual.texto_apoio|linebreaks }}
            </div>
            
            {% if conteudo_atual.arquivo %}
            <div class="pt-6 mt-8 border-t border-slate-200">
                <h4 class="flex items-center gap-2 mb-3 font-bold text-slate-800">
                    <i class="text-indigo-500 fas fa-paperclip"></i> Anexos
                </h4>
                <a href="{{ conteudo_atual.arquivo.url }}" target="_blank" class="flex items-center gap-3 p-3 transition bg-white border shadow-sm rounded-xl border-slate-200 hover:border-indigo-300 group w-fit">
                    <div class="flex items-center justify-center w-10 h-10 text-lg text-red-500 rounded-lg bg-red-50"><i class="far fa-file-pdf"></i></div>
                    <div><p class="text-sm font-bold text-slate-700">Baixar Material</p></div>
                </a>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <div class="w-full lg:w-[400px] flex flex-col bg-white/90 backdrop-blur-xl border border-white/60 rounded-[2.5rem] shadow-2xl overflow-hidden h-full shrink-0">
        
        <div class="p-4 border-b bg-slate-50/80 border-slate-100">
            <div class="flex p-1 rounded-xl bg-slate-200/50">
                <button @click="sidebarTab = 'aulas'" 
                        :class="sidebarTab === 'aulas' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'"
                        class="flex items-center justify-center flex-1 gap-2 py-2.5 text-sm font-bold transition-all rounded-lg">
                    <i class="fas fa-list-ul"></i> Aulas
                </button>
                <button @click="sidebarTab = 'conteudos'" 
                        :class="sidebarTab === 'conteudos' ? 'bg-white text-purple-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'"
                        class="flex items-center justify-center flex-1 gap-2 py-2.5 text-sm font-bold transition-all rounded-lg">
                    <i class="fas fa-folder-open"></i> Conteúdos
                </button>
                <button @click="sidebarTab = 'ferramentas'" 
                        :class="sidebarTab === 'ferramentas' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'"
                        class="flex items-center justify-center flex-1 gap-2 py-2.5 text-sm font-bold transition-all rounded-lg">
                    <i class="fas fa-toolbox"></i> Tools
                </button>
            </div>
        </div>

        <div class="flex-1 px-4 py-4 space-y-4 overflow-y-auto custom-scrollbar">
            
            <div x-show="sidebarTab === 'aulas'" class="space-y-3" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-x-4" x-transition:enter-end="opacity-100 translate-x-0">
                {% if modulos %}
                    {% for modulo in modulos %}
                    <div x-data="{ open: true }" class="overflow-hidden bg-white border shadow-sm border-slate-100 rounded-2xl">
                        <button @click="open = !open" class="flex items-center justify-between w-full p-4 transition bg-slate-50/50 hover:bg-slate-100">
                            <span class="text-xs font-bold tracking-widest uppercase text-slate-500">{{ modulo.titulo }}</span>
                            <i class="text-xs transition-transform fas fa-chevron-down text-slate-400" :class="{'rotate-180': open}"></i>
                        </button>
                        
                        <div x-show="open" class="divide-y divide-slate-50">
                            {% for aula in modulo.conteudos.all %}
                            <a href="?aula={{ aula.id }}" class="flex items-center gap-3 p-3 transition border-l-4 hover:bg-indigo-50 group {% if conteudo_atual.id == aula.id %}border-indigo-500 bg-indigo-50/50{% else %}border-transparent hover:border-indigo-300{% endif %}">
                                <div class="flex items-center justify-center w-8 h-8 bg-white border rounded-full border-slate-200 text-[10px] text-slate-400 group-hover:border-indigo-400 group-hover:text-indigo-500 shadow-sm">
                                    {% if aula.tipo == 'EXERCICIO' %}
                                        <i class="fas fa-pencil-alt"></i>
                                    {% elif aula.tipo == 'TEXTO' %}
                                        <i class="fas fa-file-alt"></i>
                                    {% else %}
                                        <i class="fas fa-play ml-0.5"></i>
                                    {% endif %}
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium leading-tight text-slate-700 group-hover:text-indigo-800 line-clamp-2">{{ aula.titulo }}</p>
                                    <p class="text-[10px] text-slate-400 mt-0.5">{{ aula.tipo|default:"Aula" }}</p>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="flex flex-col items-center justify-center py-12 text-center border-2 border-dashed border-slate-200 rounded-3xl opacity-60">
                        <i class="mb-2 text-4xl fas fa-inbox text-slate-300"></i>
                        <p class="text-sm text-slate-500">Nenhum módulo encontrado.</p>
                    </div>
                {% endif %}
            </div>

            <div x-show="sidebarTab === 'conteudos'" class="space-y-3" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-x-4" x-transition:enter-end="opacity-100 translate-x-0">
                <div class="p-4 border border-purple-100 bg-purple-50/50 rounded-2xl">
                    <h4 class="mb-3 text-xs font-bold tracking-wider text-purple-900 uppercase">
                        <i class="mr-1 fas fa-folder"></i> Arquivos do Curso
                    </h4>
                    <div class="space-y-2">
                        <a href="#" class="flex items-center gap-3 p-3 transition bg-white border border-purple-100 shadow-sm rounded-xl hover:border-purple-300 hover:shadow-md">
                            <div class="flex items-center justify-center w-8 h-8 text-red-500 rounded-lg bg-red-50"><i class="far fa-file-pdf"></i></div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold truncate text-slate-700">Ementa Completa.pdf</p>
                                <p class="text-[10px] text-slate-400">1.2 MB</p>
                            </div>
                            <i class="text-xs fas fa-download text-slate-300"></i>
                        </a>
                        <a href="#" class="flex items-center gap-3 p-3 transition bg-white border border-purple-100 shadow-sm rounded-xl hover:border-purple-300 hover:shadow-md">
                            <div class="flex items-center justify-center w-8 h-8 text-blue-500 rounded-lg bg-blue-50"><i class="far fa-file-word"></i></div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold truncate text-slate-700">Lista de Exercícios.docx</p>
                                <p class="text-[10px] text-slate-400">800 KB</p>
                            </div>
                            <i class="text-xs fas fa-download text-slate-300"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div x-show="sidebarTab === 'ferramentas'" class="space-y-6" x-data="classroomTools()" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-x-4" x-transition:enter-end="opacity-100 translate-x-0">
                <div class="p-4 border border-indigo-100 bg-indigo-50/50 rounded-2xl">
                    <h4 class="flex items-center gap-2 mb-3 text-xs font-bold tracking-wider text-indigo-900 uppercase">
                        <i class="text-lg fas fa-language"></i> Dicionário
                    </h4>
                    <div class="relative group">
                        <input type="text" x-model="dictQuery" @keydown.enter="fetchDict()" placeholder="Consultar..." class="w-full py-2.5 pl-4 pr-10 text-sm bg-white border-0 shadow-sm rounded-xl focus:ring-2 focus:ring-indigo-300">
                        <button @click="fetchDict()" class="absolute transition right-3 top-2.5 text-indigo-300 hover:text-indigo-600"><i class="fas fa-search"></i></button>
                    </div>
                    <div x-show="dictResult" class="p-4 mt-3 bg-white border shadow-sm rounded-xl border-indigo-50 animate-float">
                        <p class="text-lg font-bold text-indigo-900" x-text="dictResult.word"></p>
                        <p class="mt-1 text-xs leading-relaxed text-slate-600" x-text="dictResult.definition"></p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    function classroomTools() {
        return {
            dictQuery: '',
            dictResult: null,
            async fetchDict() {
                if(!this.dictQuery) return;
                try {
                    const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${this.dictQuery}`);
                    const data = await res.json();
                    if(data[0]) {
                        this.dictResult = {
                            word: data[0].word,
                            definition: data[0].meanings[0].definitions[0].definition,
                        };
                    }
                } catch(e) { this.dictResult = { definition: 'Não encontrado.' }; }
            }
        }
    }
</script>
{% endblock %}