{% extends "social/base.html" %}

{% block title %}Minhas Turmas - Cortex{% endblock %}

{% block content %}
<div class="space-y-6">
    
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight flex items-center gap-2">
                <span class="bg-indigo-100 text-indigo-600 p-1.5 rounded-lg dark:bg-indigo-900/30 dark:text-indigo-400 text-lg">
                    <i class="fas fa-chalkboard"></i>
                </span>
                Minhas Turmas
            </h1>
            <p class="text-sm text-gray-500 dark:text-gray-400 ml-10">Gerencie suas salas e diretrizes pedagógicas.</p>
        </div>
        
        <a href="{{ url_for('core.add_turma') }}" 
           class="inline-flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm hover:shadow-md hover:-translate-y-0.5">
            <i class="fas fa-plus"></i>
            <span>Nova Turma</span>
        </a>
    </div>

    {% if turmas %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        {% for turma in turmas %}
        
        {% set nota_coord = none %}
        {% set pontuacao_extra = none %}

        {# Verifica strings no nome da turma para atribuir a mensagem #}
        {% if '2º Integral' in turma.nome %}
            {% set nota_coord = "Estações dos saberes 7: Trazer experiências práticas (Química/Física) para ampliar potencial científico." %}
        {% elif '1º Integral A' in turma.nome %}
            {% set nota_coord = "Agroecologia: Seguir ementário rigorosamente." %}
        {% elif '1º ADM' in turma.nome %}
            {% set nota_coord = "Estações dos saberes: Utilizar apostila anexa (foco em ciências naturais)." %}
        {% elif 'Fluxo' in turma.nome %}
            {% set nota_coord = "Matemática: Foco em prática de vida, educação financeira e empreendedora. Usar materiais concretos." %}
        {% elif '2º DM' in turma.nome %}
            {% set nota_coord = "Química: Seguir plano de curso." %}
        {% elif '3º C' in turma.nome %}
            {% set nota_coord = "Eletiva: Reforço de matemática básica com atividades 'mão na massa'." %}
        {% endif %}

        {# Regra de Pontuação para Terceiros #}
        {% if '3º' in turma.nome %}
            {% set pontuacao_extra = "Pontuação: 1,0 (SAEB) + 3,0 (Simulado) + 1,0 (Gincana)." %}
        {% endif %}

        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-100 dark:border-gray-700 p-5 transition-all hover:-translate-y-1 hover:shadow-lg group flex flex-col h-full relative overflow-hidden">
            
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>

            <div class="flex justify-between items-start mb-3 mt-1">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg shadow-sm">
                    <span class="font-bold">{{ turma.nome[:1].upper() }}</span>
                </div>

                <div class="flex gap-1">
                    <a href="{{ url_for('core.editar_turma', id=turma.id) }}" 
                       class="w-7 h-7 rounded flex items-center justify-center text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors" title="Editar">
                        <i class="fas fa-cog text-xs"></i>
                    </a>
                    <a href="{{ url_for('core.excluir_turma', id=turma.id) }}" 
                       class="w-7 h-7 rounded flex items-center justify-center text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors"
                       onclick="return confirm('Excluir turma?');" title="Excluir">
                        <i class="fas fa-trash-alt text-xs"></i>
                    </a>
                </div>
            </div>
            
            <div class="mb-3">
                <h3 class="text-lg font-bold text-gray-900 dark:text-white truncate leading-tight" title="{{ turma.nome }}">
                    <a href="{{ url_for('alunos.turma', id_turma=turma.id) }}" class="hover:text-indigo-600 dark:hover:text-indigo-400">
                        {{ turma.nome }}
                    </a>
                </h3>
                <p class="text-xs text-gray-500 dark:text-gray-400 line-clamp-1 mt-1">
                    {{ turma.descricao or 'Sem descrição.' }}
                </p>
            </div>

            {% if nota_coord or pontuacao_extra %}
            <div class="mb-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-100 dark:border-yellow-900/30 rounded-lg p-3">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fas fa-bullhorn text-yellow-600 dark:text-yellow-500 text-xs"></i>
                    <span class="text-xs font-bold text-yellow-700 dark:text-yellow-500 uppercase">Coordenação</span>
                </div>
                
                {% if nota_coord %}
                <p class="text-xs text-gray-700 dark:text-gray-300 leading-snug mb-1.5">
                    {{ nota_coord }}
                </p>
                {% endif %}

                {% if pontuacao_extra %}
                <div class="border-t border-yellow-200 dark:border-yellow-800/50 pt-1 mt-1">
                    <p class="text-[10px] font-semibold text-yellow-800 dark:text-yellow-400">
                        <i class="fas fa-star mr-1"></i> {{ pontuacao_extra }}
                    </p>
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <div class="flex items-center gap-3 mb-4 mt-auto">
                <div class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-medium bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border border-blue-100 dark:border-blue-800">
                    <i class="fas fa-users"></i>
                    <span>{{ turma.alunos|length }}</span>
                </div>
                
                {% if turma.turno %}
                <div class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-medium bg-purple-50 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 border border-purple-100 dark:border-purple-800">
                    <i class="fas fa-clock"></i>
                    <span>{{ turma.turno }}</span>
                </div>
                {% endif %}
            </div>

            <a href="{{ url_for('alunos.turma', id_turma=turma.id) }}" 
               class="block w-full text-center py-2 px-3 rounded-lg bg-gray-50 text-gray-700 font-semibold text-xs hover:bg-indigo-600 hover:text-white dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-indigo-600 transition-all border border-gray-100 dark:border-gray-600 hover:border-transparent">
                Gerenciar
            </a>
        </div>
        {% endfor %}
        
        <a href="{{ url_for('core.add_turma') }}" class="border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl p-4 flex flex-col items-center justify-center text-gray-400 hover:text-indigo-600 hover:border-indigo-400 dark:hover:text-indigo-400 transition-all group min-h-[220px]">
            <div class="w-12 h-12 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center mb-3 group-hover:bg-indigo-50 dark:group-hover:bg-indigo-900/20 transition-colors">
                <i class="fas fa-plus text-lg"></i>
            </div>
            <span class="font-medium text-sm">Criar Nova Turma</span>
        </a>

    </div>
    {% else %}
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center max-w-xl mx-auto">
        <div class="w-16 h-16 bg-indigo-50 dark:bg-indigo-900/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-chalkboard text-3xl text-indigo-400"></i>
        </div>
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Comece por aqui</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Crie sua primeira turma para ver as diretrizes da coordenação.</p>
        <a href="{{ url_for('core.add_turma') }}" class="inline-flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-medium shadow-md">
            <i class="fas fa-plus"></i> Criar Turma
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}