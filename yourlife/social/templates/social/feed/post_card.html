{% load static %}

<div class="group relative w-full mb-10 overflow-hidden transition-all duration-500 rounded-[2.5rem] shadow-2xl bg-slate-900 border border-slate-800" id="post-{{ post.id }}">

    <div class="relative w-full aspect-[4/5] md:aspect-[9/16] lg:aspect-[4/5] overflow-hidden bg-black">
        
        {% if post.video %}
            <video class="absolute inset-0 w-full h-full object-cover transform transition-transform duration-[3s] group-hover:scale-105" 
                   autoplay loop muted playsinline 
                   poster="{{ post.imagem.url|default:'' }}">
                <source src="{{ post.video.url }}" type="video/mp4">
            </video>
            <div class="absolute z-20 top-6 right-6">
                <div class="flex items-center justify-center w-8 h-8 border rounded-full bg-black/40 backdrop-blur-md border-white/20 animate-pulse">
                    <i class="text-xs fas fa-video text-white/90"></i>
                </div>
            </div>
        {% elif post.imagem %}
            <img src="{{ post.imagem.url }}" 
                 class="absolute inset-0 w-full h-full object-cover transform transition-transform duration-[3s] group-hover:scale-110"
                 loading="lazy" alt="Post content">
        {% else %}
            <div class="absolute inset-0 w-full h-full bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 animate-pulse"></div>
            <div class="absolute inset-0 opacity-20" style="background-image: url('data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noiseFilter%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noiseFilter)%22 opacity=%221%22/%3E%3C/svg%3E');"></div>
        {% endif %}

        <div class="absolute inset-0 z-10 pointer-events-none bg-gradient-to-b from-black/30 via-transparent to-black/90"></div>
        
        <div class="absolute z-20 flex items-center gap-3 top-6 left-6 right-16">
            <a href="{% url 'yourlife_social:profile_detail' post.autor.username %}" class="relative cursor-pointer group/avatar">
                <div class="w-11 h-11 rounded-full p-[2px] bg-gradient-to-tr from-indigo-500 to-purple-500 backdrop-blur-sm">
                    <img src="{{ post.autor.profile.avatar.url|default:'https://ui-avatars.com/api/?name=User&background=random' }}" 
                         class="object-cover w-full h-full border-2 rounded-full border-slate-900">
                </div>
            </a>

            <div class="flex flex-col">
                <div class="flex items-center gap-1.5">
                    <span class="text-white font-bold text-[15px] tracking-wide drop-shadow-md shadow-black">{{ post.autor.username }}</span>
                    {% if post.autor.profile.is_verified %}
                        <i class="fas fa-certificate text-blue-400 text-[12px] drop-shadow-sm"></i>
                    {% endif %}
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-white/70 text-[11px] font-medium drop-shadow-md">{{ post.data_criacao|timesince }}</span>
                    {% if post.location %}
                        <span class="w-1 h-1 rounded-full bg-white/40"></span>
                        <span class="text-indigo-300 text-[11px] font-bold uppercase tracking-wider drop-shadow-md">{{ post.location }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="absolute z-30 flex flex-col items-center gap-6 right-4 bottom-28">
            
            <div class="flex flex-col items-center gap-1 group/like">
                <button hx-post="{% url 'yourlife_social:toggle_like' post.id %}" 
                        hx-swap="outerHTML" 
                        hx-target="#like-icon-{{ post.id }}"
                        class="flex items-center justify-center w-12 h-12 transition-all border rounded-full shadow-lg bg-white/10 backdrop-blur-xl border-white/20 hover:bg-white/25 active:scale-90">
                    <div id="like-icon-{{ post.id }}">
                        {% if post.user_liked %}
                            <i class="fas fa-heart text-2xl text-rose-500 drop-shadow-[0_2px_10px_rgba(244,63,94,0.6)]"></i>
                        {% else %}
                            <i class="text-2xl text-white transition-colors fas fa-heart drop-shadow-md group-hover/like:text-rose-400"></i>
                        {% endif %}
                    </div>
                </button>
                <span class="text-xs font-bold text-white drop-shadow-md">{{ post.total_likes }}</span>
            </div>

            <div class="flex flex-col items-center gap-1">
                <button onclick="document.getElementById('glass-comment-input-{{ post.id }}').focus()" 
                        class="flex items-center justify-center w-12 h-12 transition-all border rounded-full shadow-lg bg-white/10 backdrop-blur-xl border-white/20 hover:bg-white/25 active:scale-90">
                    <i class="text-2xl text-white fas fa-comment-dots drop-shadow-md"></i>
                </button>
                <span class="text-xs font-bold text-white drop-shadow-md">{{ post.total_comentarios }}</span>
            </div>

            <div class="flex flex-col items-center gap-1">
                <button class="flex items-center justify-center w-12 h-12 transition-all border rounded-full shadow-lg bg-white/10 backdrop-blur-xl border-white/20 hover:bg-white/25 active:scale-90">
                    <i class="text-xl text-white fas fa-share drop-shadow-md"></i>
                </button>
                <span class="text-xs font-bold text-white drop-shadow-md">Share</span>
            </div>
        </div>

        <div class="absolute z-20 bottom-6 left-4 right-20">
            <div class="p-4 transition-all duration-300 border shadow-xl bg-black/30 backdrop-blur-xl border-white/10 rounded-2xl hover:bg-black/40">
                
                {% if post.conteudo %}
                <p class="text-white text-[14px] font-medium leading-relaxed drop-shadow-sm line-clamp-3 hover:line-clamp-none transition-all">
                    {{ post.conteudo }}
                </p>
                {% endif %}
                
                <form hx-post="{% url 'yourlife_social:add_comment' post.id %}" 
                      hx-swap="none" 
                      hx-on::after-request="this.reset()"
                      class="flex items-center gap-2 pt-3 mt-3 border-t border-white/10">
                    <div class="overflow-hidden border rounded-full w-7 h-7 shrink-0 border-white/20">
                        <img src="{{ request.user.profile.avatar.url|default:'https://ui-avatars.com/api/?name=Me' }}" class="object-cover w-full h-full">
                    </div>
                    <input type="text" 
                           id="glass-comment-input-{{ post.id }}"
                           name="conteudo" 
                           placeholder="Responda..." 
                           class="w-full h-auto p-0 text-xs font-medium text-white bg-transparent border-none placeholder-white/60 focus:ring-0"
                           autocomplete="off">
                    <button type="submit" class="text-indigo-400 hover:text-indigo-300">
                        <i class="text-xs fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>

    </div>
</div>
