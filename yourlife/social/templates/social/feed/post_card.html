{% load static %}

<div class="group relative mb-10 overflow-hidden transition-all duration-700 border rounded-[3rem] bg-white/25 backdrop-blur-3xl border-white/60 shadow-[0_12px_40px_rgba(0,0,0,0.02)] hover:shadow-[0_25px_60px_rgba(0,0,0,0.05)] hover:bg-white/40 hover:scale-[1.01]" id="post-{{ post.id }}">
    
    <div class="absolute -top-24 -right-24 w-64 h-64 transition-opacity duration-1000 rounded-full opacity-0 pointer-events-none -z-10 bg-gradient-to-br from-indigo-300/20 to-purple-300/20 blur-[80px] group-hover:opacity-100"></div>

    <div class="flex items-center justify-between px-8 bg-transparent py-7">
        <div class="flex items-center space-x-4">
            {% if not post.is_system_event %}
                <a href="{% url 'yourlife_social:profile_detail' post.autor.username %}" class="relative cursor-pointer">
            {% else %}
                <div class="relative">
            {% endif %}
            
                <div class="w-14 h-14 rounded-[1.2rem] p-[2px] bg-gradient-to-tr from-white/80 via-indigo-300/50 to-white/80 shadow-sm transition-all duration-500 group-hover:rounded-full">
                    <div class="w-full h-full overflow-hidden bg-white/40 border border-white/40 rounded-[1.1rem] group-hover:rounded-full transition-all duration-500">
                        {% if post.autor.profile.avatar %}
                            <img src="{{ post.autor.profile.avatar.url }}" class="object-cover w-full h-full">
                        {% else %}
                            <div class="flex items-center justify-center w-full h-full text-xs font-black text-indigo-500 bg-white/50">
                                {{ post.autor.first_name|first|upper }}
                            </div>
                        {% endif %}
                    </div>
                </div>

            {% if not post.is_system_event %}
                </a>
            {% else %}
                </div>
            {% endif %}

            <div class="leading-tight">
                <div class="flex items-center gap-2">
                    {% if not post.is_system_event %}
                        <a href="{% url 'yourlife_social:profile_detail' post.autor.username %}" class="text-[16px] font-black tracking-tight text-slate-800 transition-colors hover:text-indigo-600">
                            {{ post.autor.username }}
                        </a>
                    {% else %}
                        <span class="text-[16px] font-black tracking-tight text-slate-800">{{ post.autor.username }}</span>
                    {% endif %}
                    
                    {% if post.autor.profile.is_verified %}
                        <div class="flex items-center justify-center w-4 h-4 bg-indigo-500 rounded-full">
                             <i class="fas fa-check text-[7px] text-white"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="flex items-center gap-2 mt-1">
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{{ post.data_criacao|timesince }}</p>
                    {% if post.location %}
                        <span class="text-slate-300 text-[10px]">•</span>
                        <span class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">{{ post.location }}</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <button class="flex items-center justify-center w-10 h-10 transition-all rounded-2xl text-slate-300 hover:bg-white/60 hover:text-slate-600">
            <i class="text-sm fas fa-ellipsis-h"></i>
        </button>
    </div>

    {% if post.conteudo %}
    <div class="pb-6 px-9">
        <p class="text-[15px] leading-[1.7] text-slate-600 font-medium tracking-tight">
            {{ post.conteudo|truncatechars:280 }}
            {% if post.conteudo|length > 280 %}
                <button class="ml-1 text-xs font-black tracking-widest text-indigo-500 uppercase hover:text-indigo-700">Ler mais</button>
            {% endif %}
        </p>
    </div>
    {% endif %}

    {% if post.imagem %}
    <div class="px-6 pb-6 bg-transparent">
        <div class="relative group/media overflow-hidden rounded-[2.5rem] bg-white/20 border border-white/40 shadow-inner">
            <img src="{% if post.is_system_event %}{{ post.imagem }}{% else %}{{ post.imagem.url }}{% endif %}" 
                 class="w-full h-auto object-cover max-h-[650px] transition-all duration-1000 group-hover/media:scale-[1.04] group-hover/media:rotate-1" 
                 loading="lazy">
            <div class="absolute inset-0 transition-opacity duration-500 opacity-0 bg-gradient-to-t from-black/5 to-transparent group-hover/media:opacity-100"></div>
        </div>
    </div>
    {% endif %}

    <div class="flex items-center justify-between py-5 border-t px-9 border-white/30 bg-white/5">
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 cursor-pointer group/stat">
                <div class="flex -space-x-2">
                    <div class="flex items-center justify-center w-6 h-6 border-2 rounded-full shadow-sm border-white/80 bg-rose-400"><i class="fas fa-heart text-[8px] text-white"></i></div>
                    <div class="flex items-center justify-center w-6 h-6 bg-indigo-400 border-2 rounded-full shadow-sm border-white/80"><i class="fas fa-bolt text-[8px] text-white"></i></div>
                </div>
                <span class="text-[11px] font-black text-slate-400 group-hover/stat:text-indigo-600 transition-colors uppercase tracking-widest">{{ post.total_likes }}</span>
            </div>
            
            <div class="w-px h-4 bg-slate-200/50"></div>

            <div class="flex items-center gap-2 cursor-pointer group/stat">
                <i class="far fa-comment text-slate-300 group-hover/stat:text-indigo-500"></i>
                <span class="text-[11px] font-black text-slate-400 group-hover/stat:text-indigo-600 uppercase tracking-widest">{{ post.total_comentarios }}</span>
            </div>
        </div>
        
        <div class="flex gap-2 text-[10px] font-black text-slate-300 uppercase tracking-widest">
            <span>{{ post.total_views|default:"1.2k" }} views</span>
        </div>
    </div>

    <div class="flex items-center justify-between px-5 py-3 bg-white/10">
        <div class="flex items-center flex-1 gap-3">
            
            {% if not post.is_system_event %}
            <button hx-post="{% url 'yourlife_social:toggle_like' post.id %}" 
                    hx-swap="outerHTML" 
                    hx-target="#like-btn-{{ post.id }}" 
                    id="like-btn-{{ post.id }}" 
                    class="flex items-center justify-center flex-1 py-3 space-x-2 transition-all rounded-[1.5rem] hover:bg-rose-500/10 group/btn active:scale-95">
                {% if post.user_liked %}
                    <i class="text-xl text-rose-500 fas fa-heart animate-heart"></i>
                    <span class="text-[10px] font-black uppercase tracking-[0.2em] text-rose-500">Amei</span>
                {% else %}
                    <i class="text-xl transition-colors far fa-heart text-slate-300 group-hover/btn:text-rose-500"></i>
                    <span class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 group-hover/btn:text-rose-500">Curtir</span>
                {% endif %}
            </button>
            {% endif %}

            <button onclick="document.getElementById('comment-input-{{ post.id }}').focus()" 
                    class="flex items-center justify-center flex-1 py-3 space-x-2 transition-all rounded-[1.5rem] hover:bg-indigo-500/10 group/btn active:scale-95">
                <i class="text-xl transition-colors far fa-comment text-slate-300 group-hover/btn:text-indigo-600"></i>
                <span class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 group-hover/btn:text-indigo-600">Comentar</span>
            </button>

            <button class="flex items-center justify-center flex-1 py-3 space-x-2 transition-all rounded-[1.5rem] hover:bg-emerald-500/10 group/btn active:scale-95">
                <i class="text-xl transition-colors far fa-paper-plane text-slate-300 group-hover/btn:text-emerald-600"></i>
                <span class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 group-hover/btn:text-emerald-600">Enviar</span>
            </button>
        </div>

        {% if not post.is_system_event %}
        <button class="p-4 transition-all rounded-2xl hover:bg-amber-500/10 text-slate-300 hover:text-amber-500 active:scale-90">
            <i class="text-xl far fa-bookmark"></i>
        </button>
        {% endif %}
    </div>

    {% if not post.is_system_event %}
    <div class="px-8 border-t py-7 border-white/40 bg-white/20">
        <form hx-post="{% url 'yourlife_social:add_comment' post.id %}" 
              hx-swap="none" 
              hx-on::after-request="this.reset()" 
              class="flex items-center gap-4">
            
            <div class="relative w-10 h-10 overflow-hidden border-2 border-white shadow-sm shrink-0 rounded-2xl bg-white/60">
                <img src="{{ request.user.profile.avatar.url|default:'/static/img/avatar.png' }}" class="object-cover w-full h-full">
            </div>

            <div class="relative flex-1">
                <input type="text" 
                       name="conteudo" 
                       id="comment-input-{{ post.id }}" 
                       placeholder="Adicione um comentário..." 
                       class="w-full pl-6 pr-14 py-4 text-sm transition-all bg-white/40 border border-white/60 rounded-[1.8rem] focus:ring-8 focus:ring-indigo-500/5 focus:border-indigo-400 text-slate-700 placeholder-slate-400 outline-none shadow-sm"
                       required 
                       autocomplete="off">
                
                <button type="submit" class="absolute right-3 top-2.5 w-10 h-10 flex items-center justify-center text-indigo-500 hover:text-indigo-700 transition-colors">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </form>
    </div>
    {% endif %}

</div>